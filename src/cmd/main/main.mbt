/// Main program entry point for Moonbit ZSTD
/// ä½¿ç”¨ @fs åº“æµ‹è¯•æ–‡ä»¶è¯»å–åŠŸèƒ½

/// Main function
fn main {
  println("ðŸš€ MoonBit ZSTD é¡¹ç›® - æ–‡ä»¶ç³»ç»Ÿæµ‹è¯•")
  println("ðŸ“ ä½¿ç”¨ moonbitlang/x/fs åº“")
  println(repeat_string("=", 50))
  
  // 1. æµ‹è¯•åŸºæœ¬æ–‡ä»¶ç³»ç»ŸåŠŸèƒ½
  test_basic_fs_operations()
  
  println("")
  println("âœ¨ æ–‡ä»¶ç³»ç»Ÿæµ‹è¯•å®Œæˆï¼")
}

/// æµ‹è¯•åŸºæœ¬æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
fn test_basic_fs_operations() -> Unit {
  println("ðŸ” åŸºæœ¬æ–‡ä»¶ç³»ç»Ÿæ“ä½œæµ‹è¯•:")
  
  // æµ‹è¯•å½“å‰ç›®å½•
  let current_exists = @fs.path_exists(".")
  println("   å½“å‰ç›®å½• (.): " + bool_status(current_exists))
  
  // æµ‹è¯•çˆ¶ç›®å½•
  let parent_exists = @fs.path_exists("..")
  println("   çˆ¶ç›®å½• (..): " + bool_status(parent_exists))
  
  // æµ‹è¯•ä¸€ä¸ªç®€å•çš„æ–‡ä»¶è¯»å–
  let test_file = "../zstd/tests/golden-decompression/empty-block.zst"
  if @fs.path_exists(test_file) {
    println("   âœ… æ‰¾åˆ°æµ‹è¯•æ–‡ä»¶: " + test_file)
    
    try {
      let file_data = @fs.read_file_to_bytes(test_file)
      println("   ðŸ“Š æ–‡ä»¶å¤§å°: " + file_data.length().to_string() + " å­—èŠ‚")
      
      // éªŒè¯ ZSTD é­”æ•°
      if file_data.length() >= 4 {
        let magic = file_data[0].to_int() |
                   (file_data[1].to_int() << 8) |
                   (file_data[2].to_int() << 16) |
                   (file_data[3].to_int() << 24)
        
        if magic == 0xFD2FB528 {
          println("   ðŸŽ¯ ZSTD é­”æ•°éªŒè¯: âœ…")
        } else {
          println("   ðŸŽ¯ ZSTD é­”æ•°éªŒè¯: âŒ (0x" + magic.to_string() + ")")
        }
      }
    } catch {
      err => println("   âŒ è¯»å–å¤±è´¥: " + err.to_string())
    }
  } else {
    println("   âŒ æµ‹è¯•æ–‡ä»¶ä¸å­˜åœ¨: " + test_file)
  }
}

/// æ ¼å¼åŒ–å¸ƒå°”å€¼çŠ¶æ€
fn bool_status(value : Bool) -> String {
  if value { "âœ…" } else { "âŒ" }
}

/// é‡å¤å­—ç¬¦ä¸²
fn repeat_string(s : String, n : Int) -> String {
  let mut result = ""
  for i = 0; i < n; i = i + 1 {
    result = result + s
  }
  result
}
